---
layout: archive
title:  "[Book] 가상 면접 사례로 배우는 대규모 시스템 설계 기초"
date:   2023-05-05 20:05:07 +0900
categories: Book
---

## 가상 면접 사례로 배우는 대규모 시스템 설계 기초

4장
### 처리율 제한 장치
- 수용 가능한 트래픽 이상의 트래픽이 발생할 때 처리하는 방식을 생각합니다.
- 보통  API 서버 측에 트래픽 제한 장치 뿐 라니라, SSL 종단, 사용자 인증을 담당하는 클라우드 서비스를 사용합니다.
- 처리율 제한 알고리즘 검색해 보기.
### http 규약에서 트래픽 관련
- 한도 제한이 걸리는 경우 429 코드를 전달합니다.
- X-Ratelimit 관련 헤더들은 제한이 걸리기까지 얼마나 요청이 남았는지, 제한에 설리지 않으려면 얼마의 시간이 남았는지 등을 파악하는 정보입니다.
- 처리율 제한에 의해, too many requests 상태가 되면 그 이상의 요청을 무시할 것인지 메시지 큐에 보관할 것인지 결정할 수 있습니다.
- 이때 카운팅하는 프로그램 설계 시 락/동기화 등을 고려해서 설계해야 합니다. (이후 설명)

## 5장
### 해시키 재배치
- 서버의 부하를 균등하게 나누는 방법은 숫자로 만들어진 해시키를 %4로 나누는 것입니다.
- 이 방식은 서버 개수가 균일한 경우는 문제가 없지만 증설되거나 감축될 때 인덱스가 변하게 되어, 균일하게 부하가 배치되비 않는다는 문제가 있습니다.

**안정해시 방식**
- ` (해시키의 개수) / (슬롯의 개수)` 개의 키만 재배치하는 기술입니다.
- 해시링을 만들어 시계방향으로 가까운 서버에 요청을 배치하는 방식입니다. 하지만 이 경우, 파티션이 불균등한 문제가 발생하게 됩니다.
- 이때, **가상노드**를 배치하여 최대한 균일하게 파티선을 구성해 두는 방식이 있습니다.
- 기존 파티션 사이사이에 가상 노드를 두는 방식으로 s0과 s1 서버가 있다면, s0_1, s0_2, s1_1, s1_2 여섯 개의 노드를 교차로 배치하여 가까운 서버가 s1_1이라면 s1으로 간주합니다.

## 6장
### 키-값 저장소 설계
- 고유 식별자 키는 일반 텍스트 / 리스트 / 객체 등의 값을 가질 수 있습니다.
- 단일 서버와 분산 서버의 키-값 저장소를 어떻게 설계하는지에 대한 내용입니다.
### CAP 정리
- 데이터 일관성, 가용성, 파티션 감내라는 세 요구사항을 동시에 만족시킬 수 없다는 정리입니다. 셋 중 두 가지를 만족시키면, 하나는 희생되어야 합니다.
- 데이터 일관성: 분산 시스템에 접속하는 모든 클라이언트는 어떤 노드에 접속했든 항상 같은 데이터를 봅니다.
- 가용성: 분산 시스템에 접속하는 클라이언트는 일부 노드에 장애가 발생하더라도 응답을 받을 수 있습니다.
- 파티션 감내: 파티션은 두 노드 사이에 발생하는 통신장애. 네트워크에 파티션이 생겨도, 시스템은 계속 동작 해야합니다.

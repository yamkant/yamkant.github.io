---
layout: archive
title:  "[Study] AWS 기본 개념"
date:   2023-07-10 10:05:07 +0900
categories: 
    - Study
---

## Amazon VPC
- AWS에 생성하는 가상의 네트워크(Virtual Private Cloud)를 의미합니다.
- EC2나 RDS의 경우, VPC를 먼저 선택해야합니다.
- VPC내에 서버를 설치하면 해당 네트워크에 소속되지만, 별도로 설정하지 않으면 격리된 네트워크입니다.
- 외부와 통신하기 위해 인터넷 혹은 회사 LAN과 연결해야합니다.

**기능**
- 네트워킹 환경을 설정합니다.
- IPv4, IPv6 둘 다 사용가능합니다. 
- CIDR 블록, 서브넷 마스크를 설정할 수 있습니다.
- 물리적인 라우터가 아닌 소프트웨어가 라우터의 역할을 수행하는 방식입니다.
- 라우팅 테이블을 통해 여러 개의 서브넷과 연결합니다.
- 서브넷 내에서의 통신은 라우터 없이 직접 가능합니다.

**VPC 설정**
- 인터넷에 연결해야 한다면 인터넷 게이트웨이를 설정하고, 라우팅 테이블과 맵핑하여 라우팅을 설정합니다.
- 오토 스케일링을 설정해야 한다면 IP 주소를 많이 확보해 두어야합니다.
1. VPC 생성: VPC 이름 설정 / CIDR 블록 설정 / 테넌시(하드웨어의 점유 여부) 선택
2. 서브넷 설정: 서브넷 이름 설정 / 대상 VPC 선택 / 가용 영역 선택 / CIDR 블록(서브넷) 설정
3. 인터넷 연결: 인터넷 게이트웨이 생성 / IGW와 VPC 연결 / 라우팅 설정

**서브넷과 DHCP: 사용 범위 선택**
- 서브넷: 커다란 네트워크를 작게 나눈 네트워크를 의미합니다.
- 네트워크를 분할하여 직접 통신할 수 있는 범위 좁히며, 방화벽 설정을 통해 보안을 강화합니다.
- 일반적인 네트워크의 경우, 서브넷끼리 통신하기 위해서는 라우팅이 필요하지만, VPC는 라우팅 없이도 통신 가능합니다.
- CIDR(class Inter-Domain Routing): 네트워크와 서브넷의 범위를 나누는 표기법입니다.
- /24이면 IP 주소의 수가 2의 (32-24)제곱개 입니다.
- 기본 VPC는 /16인 B클래스로 설정되어 있습니다. /20 서브넷은 IP 주소 4096개를 가지므로, 오토 스케일링을 설정해도 될 만큼 충분히 많은 수의 IP 주소를 가집니다.
- DHCP (Dynamic Host Configuration Protocol): 각 호스트인 인스턴스에 IP 주소를 자동으로 할당합니다. 인스턴스가 추가될 때, 서브넷 범위의 IP 주소 중 하나가 할당됩니다.

**라우팅과 NAT**
- NAT(network Address Translation): 네트워크 주소 변환 방식으로, 
- 라우팅은 타겟 호스트에 바로 데이터를 전달하는 것이 아닌, 호스트에서 호스트로 데이터를 전달하는 방식을 의미합니다.
- 라우터에는 타겟 호스트에 가장 빠르게 정보를 전달할 수 있는 정보가 포함되어있습니다.
- 게이트웨이는 LAN에서 인터넷으로 데이터를 전송할 때, LAN 내부의 출입구가 됩니다.
- 사설 IP 주소를 공인 IP 주소로 변환하고, 회사 내에서는 공인 IP 주소 하나를 공동으로 사용합니다.
- NAPT: Network Address Port Translation으로, IP 마스커레이드라고도 합니다. 주소 변환을 담당합니다.
- IP 마스커레이드를 사용하면, 내부에서 외부로 나가는 것은 가능하지만 외부에서 내부로 들어오는 것은 불가능합니다.
- NAT(Network Address Translation): NAT를 통해 사설 IP 주소가 공인 IP 주소로 변환됩니다.
- IP 마스커레이드는 일대다이며, NAT은 다대다입니다. IP 마스커레이드는 공인 IP 하나만 설정할 수 있습니다. 서버가 여러 대라면 공인 IP 주소를 여러개 설정할 수 있는 NAT을 사용해야합니다.

**인터넷 게이트웨이, NAT 게이트웨이**
- 인터넷 게이트웨이: 인터넷 연결을 담당합니다. EC2 인스턴스와 인터넷을 연결합니다.
- NAT 게이트웨이: 서브넷에서 인터넷으로 접속할 수 있지만, 인터넷에서는 서브넷으로 접속하지 못하도록 합니다. (소프트웨어 업데이트시 이용)  
  (단일 방향으로 EC2 인스턴스와 인터넷을 연결합니다.)
- EC2 인스턴스는 사설 IP 주소밖에 설정할 수 없기 때문에, 공인 IP 주소를 사설 IP 주소로 변환하는 인터넷 게이트웨이가 필수적입니다.

**보안 그룹과 네트워크 ACL**
- VPC의 가상 방화벽으로 보안 그룹과 네트워크 ACL 두 종류의 방화벽을 사용합니다.
- 보안 그룹과 네트워크 ACL은 인바운드 트래픽과 아웃바운드 트래픽을 제어합니다. 
- 보안 그룹은 인스턴스에 대해 설정하며, 네트워크 ACL은 서브넷에 설정하기 때문에 개별 인스턴스에 설정하지 않아도 됩니다.
- 참고: 데몬은 서버의 전원이 켜져있는 동안 계속해서 동작하고 있는 소프트웨어를 말합니다. 

**VPC 엔드포인트**
- VPC 내부에서 VPC 외부로 접속하기 위한 연결점을 제공하는 서비스입니다.
- S3와 DynamoDB는 VPC를 사용하지 않는 서비스입니다. 따라서, 이와 같이 VPC 외부 서비스를 연결해주는 것이 엔드포인트 서비스입니다.
- VPC 엔드포인트는 가상 서비스로, 확장성과 고가용성을 지원합니다.
- 네트워크 트래픽에 따라 자동으로 스케일링 됩니다.
- 엔드포인트는 두 종류로, 인터페이스 엔드포인트와 게이트웨이 엔드포인트가 있습니다.
- 인터페이스 엔드포인트는 네트워크 인터페이스로 구축하는 유형이며, 게이트웨이 엔드포인트는 라우팅 테이블에 설정된 내용을 라우팅하는 유형입니다.
- 인터페이스 엔드포인트는 사설 IP 주소를 가진 ENI가 존재하며 각 서비스와 연결하는 출입구 역할을 합니다.
- AWS PrivateLink라는 방식을 사용하기 때문에, 타사 서비스가 PrivateLink를 지원한다면 사용 가능합니다.

## Amazon ELB
- AWS가 제공하는 로드 밸런서로, 집중되는 트래픽을 서버/네트워크에 분배하는 부하 분산 장치입니다.

**ALB**
- HTTP/HTTPS 프로토콜의 헤더를 보고 적절한 패킷으로 전송하므로, OSI 모형의 애플리케이션 계층(7계층)에서 동작합니다.
- `IP 주소 + 포트번호 + 패킷내용` 정보를 통해 스위칭합니다.
- L7단에서 지원하기 때문에 인스턴스와 로드 밸런서 사이에서 SSL이 적용된 암호화 통신이 가능합니다.
- IP 주소가 변동될 수 있기 때문에, Client는 DNS 주소로 접근하는 것이 좋습니다.  
  (따라서, EIP를 ALB에 설정해두는 것이 좋습니다.)

**NLB**
- TCP/IP 프로토콜의 헤더를 보고 적절한 패킷으로 전송하므로, OSI 모형의 전송 계층(4계층)에서 동작합니다.  
  (ALB보다 낮은 계층에서 동작하기 때문에 속도가 빠릅니다.)
- `IP 주소 + 포트번호` 정보를 통해고 스위칭합니다.
- EIP를 이용할 수 있으며, DNS와 IP 주소 모두 사용 가능합니다. (SSL은 사용 불가능)

## Cloud Front

**Cloud Front의 원리**
- web server란, 사용자 요청이 들어올 때, 미리 준비된 html 파일을 전송하는 것이 아닌, 프로그래밍 언어를 통해 동적으로 html 파일을 프로그래밍으로 생성하여 응답하는 방식입니다.
- 따라서, 더 많은 시간과 비용이 발생합니다. Cloud Front의 첫 번째 역할은 캐시 서버로 사용하는 것입니다.
- 전세계에 어디에 있든지 빠른 속도로 접속 가능하도록 해주는 기능을 CDN(Content Delivery Network)이라고 하는데, 전세계에 흩어져있는 AWS의 인프라를 이용하는 캐시서버로 동작하기도 합니다.
- 우리의 Web Serve는 사용자를 직접 만나지 않고, Cloud Front를 통해서 만날 수 있습니다. Web Server는 Origin, Cloud Front는 Distribution이라고 말합니다. (AWS 용어)

**캐시 제어**
- Cloud Front를 연결하여 캐싱하면, 주기적으로 사이트에 접속할 때 빠른 속도로 리소스를 가져올 수 있지만, Origin 도메인의 데이터가 변경되는 것을 실시간으로 감지할 수 없습니다. (캐싱된 정보만 가져옴)
- 이는, Origin 도메인인 Web Serve로 부터, 헤더값 `Cache-Control: max-age=60`으로 받아오기 때문입니다. 이는 60초 동안은 정보가 유용하므로 그 시간동안은 요청하지 말라는 것을 의미합니다.
- Cloud Front의 Object Caching 옵션 → Customize로 아래와 같이 설정하여, Cache-Control 헤더의 범위값을 제한할 수 있고, 설정되지 않은 경우 기본 값을 설정할 수 있습니다.  
  (Minimum TTL: 5 / Maximum TTL: 15 / Default 10)
